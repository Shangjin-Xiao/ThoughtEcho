# 大文件导入使用指南

## 概述

ThoughtEcho 现在支持安全、高效地导入大视频文件，无论文件大小如何，都能提供稳定的用户体验。本指南将帮助您了解如何使用这些新功能。

## 主要改进

### ✅ 解决的问题
- **闪退问题**：大视频文件导入不再导致应用崩溃
- **内存溢出**：智能内存管理，避免内存不足
- **UI卡顿**：后台处理，保持界面响应
- **错误处理**：友好的错误提示和恢复机制

### 🚀 新增功能
- **实时进度显示**：查看导入进度和状态
- **文件预检查**：导入前验证文件完整性
- **智能优化**：根据文件大小自动选择最佳处理策略
- **取消操作**：随时中断导入过程

## 使用方法

### 1. 导入视频文件

#### 在全屏编辑器中：

1. **打开全屏编辑器**
   - 在笔记编辑界面点击全屏编辑按钮

2. **点击视频按钮**
   - 在工具栏中找到视频图标 🎬
   - 点击后会打开增强的导入对话框

3. **选择文件**
   - 点击"选择文件"按钮
   - 浏览并选择您要导入的视频文件
   - 支持格式：MP4、MOV、AVI、MKV、WebM、3GP、M4V

4. **查看文件信息**
   - 选择文件后，会显示详细信息：
     - 文件名
     - 文件大小
     - 视频格式
   - 大文件会显示警告提示

5. **开始导入**
   - 点击"开始导入"按钮
   - 观察实时进度和状态更新
   - 可随时点击"取消导入"中断操作

### 2. 导入过程说明

#### 文件检查阶段
```
正在检查视频文件...
```
- 验证文件是否存在和可读
- 检查文件格式是否支持
- 验证文件头确保完整性

#### 准备导入阶段
```
正在准备导入...
```
- 创建目标目录
- 初始化导入参数
- 准备内存保护机制

#### 文件复制阶段
```
正在复制视频文件... 45%
```
- 分块复制文件内容
- 实时显示进度百分比
- 监控内存使用情况

#### 完成阶段
```
导入完成
```
- 验证文件完整性
- 插入到编辑器中
- 显示成功提示

### 3. 大文件处理策略

#### 小文件（< 50MB）
- 使用标准处理流程
- 快速导入，几乎无延迟

#### 大文件（≥ 50MB）
- 自动启用专用处理器
- 分块处理，内存友好
- 显示详细进度信息

#### 超大文件（> 500MB）
- 增强的内存保护
- 更大的处理块
- 自动重试机制

## 错误处理

### 常见错误及解决方案

#### 1. 内存不足
**错误提示：**
```
内存不足，无法加载视频
建议：
• 关闭其他应用释放内存
• 重启应用后重试
• 使用较小的视频文件
```

**解决方案：**
- 关闭其他占用内存的应用
- 重启 ThoughtEcho 应用
- 点击"重试"按钮
- 考虑压缩视频文件

#### 2. 文件格式不支持
**错误提示：**
```
不支持的视频格式: .xxx
```

**解决方案：**
- 转换为支持的格式（MP4、MOV等）
- 使用视频转换工具

#### 3. 文件损坏
**错误提示：**
```
文件可能已损坏或不是有效的视频文件
```

**解决方案：**
- 检查原文件是否完整
- 重新下载或获取文件
- 使用视频修复工具

#### 4. 导入超时
**错误提示：**
```
视频加载超时
文件可能过大，请稍后重试或使用较小的视频文件
```

**解决方案：**
- 等待一段时间后重试
- 检查设备性能和存储空间
- 考虑压缩视频文件

## 性能优化建议

### 1. 设备要求
- **内存**：建议至少 4GB RAM
- **存储**：确保有足够的可用空间
- **处理器**：较新的设备性能更好

### 2. 文件优化
- **压缩**：使用适当的压缩设置
- **分辨率**：根据需要调整视频分辨率
- **格式**：推荐使用 MP4 格式

### 3. 使用技巧
- **批量导入**：避免同时导入多个大文件
- **后台运行**：导入时避免切换应用
- **网络环境**：确保稳定的网络连接（如果从云端导入）

## 技术特性

### 内存管理
- **分块处理**：将大文件分成小块处理
- **懒加载**：视频播放器按需初始化
- **自动清理**：及时释放不需要的内存

### 错误恢复
- **自动重试**：内存不足时自动重试
- **状态保存**：保持导入进度状态
- **优雅降级**：在资源不足时提供替代方案

### 用户体验
- **实时反馈**：进度条和状态消息
- **可中断操作**：随时取消导入
- **智能提示**：根据情况提供建议

## 常见问题

### Q: 支持的最大文件大小是多少？
A: 理论上没有大小限制，但建议单个视频文件不超过 2GB，以确保最佳性能。

### Q: 导入大文件需要多长时间？
A: 取决于文件大小和设备性能。通常：
- 100MB 文件：10-30秒
- 500MB 文件：1-3分钟
- 1GB 文件：2-5分钟

### Q: 可以同时导入多个文件吗？
A: 建议一次导入一个大文件，以避免内存压力。

### Q: 导入失败后文件会丢失吗？
A: 不会。导入过程不会修改原文件，失败时会自动清理临时文件。

### Q: 如何查看已导入的视频？
A: 导入成功后，视频会自动插入到编辑器中，可以直接播放。

## 技术支持

如果您在使用过程中遇到问题：

1. **查看错误提示**：仔细阅读错误消息和建议
2. **尝试重试**：大多数问题可以通过重试解决
3. **检查文件**：确保视频文件完整且格式正确
4. **重启应用**：如果问题持续，尝试重启应用

## 更新日志

### v1.0.0 - 大文件处理优化
- ✅ 解决大视频文件导入闪退问题
- ✅ 新增增强的导入对话框
- ✅ 实现智能内存管理
- ✅ 添加实时进度显示
- ✅ 支持取消操作
- ✅ 增强错误处理和恢复机制

---

通过这些改进，ThoughtEcho 现在可以安全、高效地处理任意大小的视频文件，为您提供更好的笔记编辑体验。