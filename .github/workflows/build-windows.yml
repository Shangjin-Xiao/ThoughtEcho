name: Build Windows App

on:
  workflow_dispatch:
    inputs:
      app_version:
        description: 'åº”ç”¨ç‰ˆæœ¬å· - 4ä½æ ¼å¼ (å¦‚: 1.2.0.0)'
        required: true
        default: '1.0.0.0'
        type: string
      flutter_version:
        description: 'Flutterç‰ˆæœ¬'
        required: false
        default: 'latest'
        type: choice
        options:
          - '3.35.3'
          - '3.29.2'
          - '3.27.0'
          - 'latest'
      build_type:
        description: 'æž„å»ºç±»åž‹'
        required: false
        default: 'release'
        type: choice
        options:
          - 'release'
          - 'profile'

jobs:
  build-windows:
    runs-on: windows-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      
    - name: Setup Flutter
      uses: subosito/flutter-action@v2
      with:
        flutter-version: ${{ github.event.inputs.flutter_version || 'latest' }}
        channel: 'stable'
        cache: true
        
    - name: Enable Windows desktop
      run: flutter config --enable-windows-desktop
      
    - name: Update versions
      run: |
        $version = "${{ github.event.inputs.app_version || '1.0.0.0' }}"
        
        # éªŒè¯ç‰ˆæœ¬å·æ ¼å¼ï¼ˆåº”ä¸º4ä½ï¼šx.x.x.xï¼‰
        if ($version -notmatch '^\d+\.\d+\.\d+\.\d+$') {
          Write-Error "ç‰ˆæœ¬å·æ ¼å¼é”™è¯¯ï¼å¿…é¡»æ˜¯4ä½æ ¼å¼ï¼Œå¦‚: 1.0.0.0"
          exit 1
        }
        
        # æå–å‰ä¸‰ä½ç”¨äºŽ Flutter ç‰ˆæœ¬ï¼ˆx.x.xï¼‰
        if ($version -match '^(\d+\.\d+\.\d+)\.\d+$') {
          $flutterVersion = $matches[1]
        } else {
          Write-Error "æ— æ³•ä»Žç‰ˆæœ¬å·æå–Flutterç‰ˆæœ¬"
          exit 1
        }
        
        # âš ï¸ Microsoft Store è¦æ±‚ï¼šMSIX ç‰ˆæœ¬å·çš„ç¬¬å››ä½ï¼ˆRevisionï¼‰å¿…é¡»ä¸º 0
        # å¼ºåˆ¶å°†ç¬¬å››ä½è®¾ä¸º 0
        $msixVersion = "$flutterVersion.0"
        
        # æ›´æ–° pubspec.yaml ä¸­çš„ç‰ˆæœ¬ï¼ˆä¸å¸¦æž„å»ºå·ï¼‰
        $pubspecContent = Get-Content pubspec.yaml -Raw
        $pubspecContent = $pubspecContent -replace 'version:\s*[\d\.]+\+?\d*', "version: $flutterVersion"
        
        # æ›´æ–° pubspec.yaml ä¸­çš„ msix_versionï¼ˆä¿ç•™ç¼©è¿›ï¼‰
        $pubspecContent = $pubspecContent -replace '(\s*)msix_version:\s*[\d\.]+', "`$1msix_version: $msixVersion"
        $pubspecContent | Set-Content pubspec.yaml -NoNewline
        
        Write-Output "Updated Flutter version to: $flutterVersion"
        Write-Output "Updated MSIX version to: $msixVersion (Revision set to 0 for MS Store compliance)"
        
    - name: Flutter doctor
      run: flutter doctor -v
      
    - name: Get dependencies
      run: flutter pub get
      
    - name: Clean previous builds
      run: flutter clean
      
    - name: Build Windows app
      run: flutter build windows --${{ github.event.inputs.build_type || 'release' }} --verbose
      
    - name: Verify MSIX configuration
      shell: pwsh
      run: |
        Write-Host "=== éªŒè¯ MSIX é…ç½® ===" -ForegroundColor Cyan
        Write-Host ""
        
        # Microsoft Store è¦æ±‚çš„æ­£ç¡®å€¼
        $EXPECTED_PUBLISHER = "CN=14B607B9-7CF3-42D9-9054-090F3ECEC1D7"
        $EXPECTED_IDENTITY_NAME = "Shangjinyun.330094822087A"
        
        # è¯»å– pubspec.yaml é…ç½®
        $pubspecContent = Get-Content pubspec.yaml -Raw
        
        # æ£€æŸ¥ publisher é…ç½®
        if ($pubspecContent -match 'publisher:\s*([^\r\n]+)') {
          $publisher = $matches[1].Trim()
          Write-Host "Publisher é…ç½®: $publisher" -ForegroundColor Yellow
          
          if ($publisher -eq $EXPECTED_PUBLISHER) {
            Write-Host "âœ… Publisher é…ç½®æ­£ç¡®" -ForegroundColor Green
          } else {
            Write-Host "âš ï¸ Publisher é…ç½®ä¸åŒ¹é…!" -ForegroundColor Red
            Write-Host "  é¢„æœŸå€¼: $EXPECTED_PUBLISHER" -ForegroundColor Yellow
            Write-Host "  å½“å‰å€¼: $publisher" -ForegroundColor Yellow
          }
        } else {
          Write-Host "âŒ æœªæ‰¾åˆ° publisher é…ç½®" -ForegroundColor Red
        }
        
        # æ£€æŸ¥ identity_name é…ç½®
        if ($pubspecContent -match 'identity_name:\s*([^\r\n]+)') {
          $identityName = $matches[1].Trim()
          Write-Host "Identity Name é…ç½®: $identityName" -ForegroundColor Yellow
          
          if ($identityName -eq $EXPECTED_IDENTITY_NAME) {
            Write-Host "âœ… Identity Name é…ç½®æ­£ç¡®" -ForegroundColor Green
          } else {
            Write-Host "âš ï¸ Identity Name é…ç½®ä¸åŒ¹é…!" -ForegroundColor Red
            Write-Host "  é¢„æœŸå€¼: $EXPECTED_IDENTITY_NAME" -ForegroundColor Yellow
            Write-Host "  å½“å‰å€¼: $identityName" -ForegroundColor Yellow
          }
        } else {
          Write-Host "âŒ æœªæ‰¾åˆ° identity_name é…ç½®" -ForegroundColor Red
        }
        
        # æ£€æŸ¥ capabilities é…ç½®ï¼ˆä¸åº”åŒ…å« runFullTrustï¼‰
        if ($pubspecContent -match 'capabilities:\s*([^\r\n]+)') {
          $capabilities = $matches[1].Trim()
          Write-Host "Capabilities é…ç½®: $capabilities" -ForegroundColor Yellow
          
          if ($capabilities -match 'runFullTrust') {
            Write-Host "âš ï¸ è­¦å‘Š: capabilities åŒ…å« runFullTrustï¼ˆåº”è¯¥ç”± Flutter è‡ªåŠ¨æ·»åŠ ï¼‰" -ForegroundColor Yellow
          } else {
            Write-Host "âœ… Capabilities é…ç½®æ­£ç¡®ï¼ˆä¸åŒ…å« runFullTrustï¼‰" -ForegroundColor Green
          }
        }
        
        Write-Host ""
        Write-Host "â„¹ï¸ æ³¨æ„: æœ¬åœ°æž„å»ºå¯èƒ½ä½¿ç”¨æµ‹è¯•è¯ä¹¦ï¼ŒStore ä¼šåœ¨æäº¤åŽè‡ªåŠ¨é‡æ–°ç­¾å" -ForegroundColor Cyan
        Write-Host ""
      
    - name: Build MSIX installer
      shell: pwsh
      continue-on-error: true  # å…è®¸MSIXæž„å»ºå¤±è´¥ï¼Œä½†ç»§ç»­æ‰§è¡ŒåŽç»­æ­¥éª¤
      run: |
        Write-Host "æž„å»ºMSIXå®‰è£…åŒ…..." -ForegroundColor Yellow
        
        # è®¾ç½®éžäº¤äº’å¼çŽ¯å¢ƒå˜é‡
        $env:CI = "true"
        $env:MSIX_SILENT = "true"
        $env:FLUTTER_SUPPRESS_ANALYTICS = "true"
        
        try {
          # ç¡®ä¿MSIXé…ç½®æ–‡ä»¶å­˜åœ¨
          if (!(Test-Path "msix_config.yaml")) {
            Write-Warning "msix_config.yaml ä¸å­˜åœ¨ï¼Œä½¿ç”¨é»˜è®¤é…ç½®"
          }
          
          # æ£€æŸ¥Windowsæž„å»ºæ˜¯å¦æˆåŠŸ
          $buildType = "${{ github.event.inputs.build_type || 'release' }}"
          $buildPath = if ($buildType -eq "release") { "build/windows/x64/runner/Release" } else { "build/windows/x64/runner/Profile" }
          
          if (!(Test-Path "$buildPath/thoughtecho.exe")) {
            Write-Error "Windowsæž„å»ºæ–‡ä»¶ä¸å­˜åœ¨: $buildPath/thoughtecho.exe"
            "msix_success=false" | Out-File -FilePath $env:GITHUB_OUTPUT -Append -Encoding utf8
            exit 1
          }
          
          Write-Host "å¼€å§‹æž„å»ºMSIXåŒ…..." -ForegroundColor Green
          
          # ç›´æŽ¥è¿è¡ŒMSIXåˆ›å»ºå‘½ä»¤
          flutter pub run msix:create
          $exitCode = $LASTEXITCODE
          
          if ($exitCode -eq 0) {
            # æ£€æŸ¥MSIXæ–‡ä»¶æ˜¯å¦å®žé™…åˆ›å»ºæˆåŠŸï¼ˆå°è¯•å¤šä¸ªå¯èƒ½çš„æ–‡ä»¶åï¼‰
            $possibleMsixPaths = @(
              "build/windows/x64/runner/Release/ThoughtEcho-Setup.msix",
              "build/windows/x64/runner/Release/thoughtecho.msix"
            )
            
            $msixPath = $null
            foreach ($path in $possibleMsixPaths) {
              if (Test-Path $path) {
                $msixPath = $path
                break
              }
            }
            
            if ($msixPath) {
              $msixSize = (Get-Item $msixPath).Length
              Write-Host "MSIXæž„å»ºæˆåŠŸï¼æ–‡ä»¶: $msixPath, å¤§å°: $([math]::Round($msixSize/1MB, 2)) MB" -ForegroundColor Green
              "msix_success=true" | Out-File -FilePath $env:GITHUB_OUTPUT -Append -Encoding utf8
              "msix_path=$msixPath" | Out-File -FilePath $env:GITHUB_OUTPUT -Append -Encoding utf8
            } else {
              Write-Warning "MSIXå‘½ä»¤æ‰§è¡ŒæˆåŠŸä½†æ–‡ä»¶æœªæ‰¾åˆ°ï¼Œå°è¯•è¿‡çš„è·¯å¾„: $($possibleMsixPaths -join ', ')"
              "msix_success=false" | Out-File -FilePath $env:GITHUB_OUTPUT -Append -Encoding utf8
            }
          } else {
            Write-Warning "MSIXæž„å»ºå¤±è´¥(é€€å‡ºç : $exitCode)"
            "msix_success=false" | Out-File -FilePath $env:GITHUB_OUTPUT -Append -Encoding utf8
          }
        }
        catch {
          Write-Warning "MSIXæž„å»ºå¼‚å¸¸: $($_.Exception.Message)"
          "msix_success=false" | Out-File -FilePath $env:GITHUB_OUTPUT -Append -Encoding utf8
        }
      id: msix_build
      env:
        FLUTTER_SUPPRESS_ANALYTICS: true
      
    - name: Get app version
      id: version
      run: |
        $content = Get-Content pubspec.yaml -Raw
        if ($content -match 'version:\s*([\d\.]+\+?\d*)') {
          $version = $matches[1]
          "version=$version" | Out-File -FilePath $env:GITHUB_OUTPUT -Append
          Write-Output "App version: $version"
        } else {
          Write-Error "æ— æ³•ä»Ž pubspec.yaml ä¸­æå–ç‰ˆæœ¬å·"
          exit 1
        }
      
    - name: Create release packages
      run: |
        $buildType = "${{ github.event.inputs.build_type || 'release' }}"
        $buildPath = if ($buildType -eq "release") { "build/windows/x64/runner/Release" } else { "build/windows/x64/runner/Profile" }
        $version = "${{ steps.version.outputs.version }}"
        
        if (!(Test-Path $buildPath)) {
            Write-Error "æž„å»ºè·¯å¾„ä¸å­˜åœ¨: $buildPath"
            exit 1
        }
        
        # åˆ›å»ºZIPåŽ‹ç¼©åŒ…
        $archiveName = "thoughtecho-windows-x64-v$version-$buildType.zip"
        New-Item -ItemType Directory -Path "release_temp" -Force
        Copy-Item -Path "$buildPath/*" -Destination "release_temp/" -Recurse
        
        # åˆ›å»ºç‰ˆæœ¬ä¿¡æ¯æ–‡ä»¶å†…å®¹
        $versionInfo = "ThoughtEcho Windowsç‰ˆæœ¬ä¿¡æ¯`nç‰ˆæœ¬: $version`næž„å»ºç±»åž‹: $buildType`næž„å»ºæ—¶é—´: $(Get-Date -Format 'yyyy-MM-dd HH:mm:ss')`nFlutterç‰ˆæœ¬: ${{ github.event.inputs.flutter_version || '3.29.2' }}`næäº¤: ${{ github.sha }}`n`nä½¿ç”¨è¯´æ˜Ž:`n1. è§£åŽ‹åˆ°ä»»æ„æ–‡ä»¶å¤¹`n2. åŒå‡» thoughtecho.exe å¯åŠ¨åº”ç”¨`n3. å¦‚é‡é—®é¢˜è¯·æŸ¥çœ‹ logs æ–‡ä»¶å¤¹ä¸‹çš„æ—¥å¿—æ–‡ä»¶`n`næ³¨æ„äº‹é¡¹:`n- é¦–æ¬¡å¯åŠ¨å¯èƒ½éœ€è¦ç­‰å¾…æ•°ç§’`n- ç¡®ä¿ç³»ç»Ÿå·²å®‰è£…Visual C++ Redistributable`n- å»ºè®®åœ¨è§£åŽ‹åŽå°†æ•´ä¸ªæ–‡ä»¶å¤¹æ·»åŠ åˆ°æ€æ¯’è½¯ä»¶ç™½åå•"
        $versionInfo | Out-File -FilePath "release_temp/VERSION_INFO.txt" -Encoding UTF8
        $versionInfo | Out-File -FilePath "release_temp/ç‰ˆæœ¬ä¿¡æ¯.txt" -Encoding UTF8

        # åˆ›å»ºå¯åŠ¨è„šæœ¬å†…å®¹
        $launchScript = "@echo off`necho æ­£åœ¨å¯åŠ¨ ThoughtEcho...`necho é¦–æ¬¡å¯åŠ¨å¯èƒ½éœ€è¦ç­‰å¾…æ•°ç§’ï¼Œè¯·è€å¿ƒç­‰å¾…`necho.`nstart thoughtecho.exe`necho å¦‚æžœåº”ç”¨æœªæ­£å¸¸å¯åŠ¨ï¼Œè¯·æ£€æŸ¥ç‰ˆæœ¬ä¿¡æ¯.txtä¸­çš„æ³¨æ„äº‹é¡¹`npause"
        $launchScript | Out-File -FilePath "release_temp/LAUNCH_APP.bat" -Encoding Default
        $launchScript | Out-File -FilePath "release_temp/å¯åŠ¨åº”ç”¨.bat" -Encoding Default
        
        Compress-Archive -Path "release_temp/*" -DestinationPath $archiveName -Force
        
        # æ£€æŸ¥MSIXæ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼ˆæ”¹è¿›é€»è¾‘ï¼‰
        $msixSuccess = "${{ steps.msix_build.outputs.msix_success }}" -eq "true"
        $msixPath = "${{ steps.msix_build.outputs.msix_path }}"
        $msixFound = $false
        
        # å…ˆæ£€æŸ¥è¾“å‡ºè·¯å¾„ä¸­çš„MSIXæ–‡ä»¶
        if ($msixSuccess -and $msixPath -and (Test-Path $msixPath)) {
            $msixFound = $true
            $sourceMsixPath = $msixPath
            Write-Host "âœ… åœ¨è¾“å‡ºè·¯å¾„æ‰¾åˆ°MSIX: $msixPath" -ForegroundColor Green
        } 
        # å¦‚æžœè¾“å‡ºè·¯å¾„æ²¡æœ‰æ‰¾åˆ°ï¼Œå°è¯•åœ¨æž„å»ºç›®å½•ä¸­æŸ¥æ‰¾
        else {
            Write-Host "âš ï¸ è¾“å‡ºè·¯å¾„æœªæ‰¾åˆ°MSIXï¼Œå°è¯•åœ¨æž„å»ºç›®å½•æœç´¢..." -ForegroundColor Yellow
            $possiblePaths = @(
                "build/windows/x64/runner/Release/ThoughtEcho-Setup.msix",
                "build/windows/x64/runner/Release/thoughtecho.msix",
                "build/windows/runner/Release/ThoughtEcho-Setup.msix",
                "build/windows/runner/Release/thoughtecho.msix",
                "build/windows/x64/ThoughtEcho-Setup.msix",
                "build/windows/x64/thoughtecho.msix"
            )
            
            foreach ($path in $possiblePaths) {
                if (Test-Path $path) {
                    $msixFound = $true
                    $sourceMsixPath = $path
                    Write-Host "âœ… åœ¨å¤‡é€‰è·¯å¾„æ‰¾åˆ°MSIX: $path" -ForegroundColor Green
                    break
                }
            }
        }
        
        # å¦‚æžœæ‰¾åˆ°MSIXæ–‡ä»¶ï¼Œå¤åˆ¶å¹¶è®¾ç½®è¾“å‡º
        if ($msixFound) {
            $msixName = "thoughtecho-windows-x64-v$version-$buildType.msix"
            Copy-Item -Path $sourceMsixPath -Destination $msixName -Force
            
            # éªŒè¯å¤åˆ¶æˆåŠŸ
            if (Test-Path $msixName) {
                $msixSize = (Get-Item $msixName).Length
                Write-Host "âœ… æˆåŠŸåˆ›å»ºMSIXå®‰è£…åŒ…: $msixName (å¤§å°: $([math]::Round($msixSize/1MB, 2)) MB)" -ForegroundColor Green
                "msix_name=$msixName" | Out-File -FilePath $env:GITHUB_OUTPUT -Append -Encoding utf8
                "has_msix=true" | Out-File -FilePath $env:GITHUB_OUTPUT -Append -Encoding utf8
            } else {
                Write-Warning "MSIXæ–‡ä»¶å¤åˆ¶å¤±è´¥"
                "has_msix=false" | Out-File -FilePath $env:GITHUB_OUTPUT -Append -Encoding utf8
            }
        } else {
            Write-Host "âš ï¸ æœªæ‰¾åˆ°MSIXæ–‡ä»¶ï¼Œå°†åªæä¾›ZIPåŒ…" -ForegroundColor Yellow
            if (!$msixSuccess) {
                Write-Host "  åŽŸå› : MSIXæž„å»ºæ­¥éª¤æŠ¥å‘Šå¤±è´¥" -ForegroundColor Gray
            } elseif (!$msixPath) {
                Write-Host "  åŽŸå› : MSIXæ–‡ä»¶è·¯å¾„æœªè®¾ç½®" -ForegroundColor Gray
            }
            Write-Host "âœ… Windowsåº”ç”¨å·²æˆåŠŸæž„å»ºï¼Œå¯é€šè¿‡ZIPåŒ…åˆ†å‘" -ForegroundColor Green
            "has_msix=false" | Out-File -FilePath $env:GITHUB_OUTPUT -Append -Encoding utf8
        }
        
        "archive_name=$archiveName" | Out-File -FilePath $env:GITHUB_OUTPUT -Append -Encoding utf8
        Write-Output "âœ… åˆ›å»ºZIPå‘å¸ƒåŒ…: $archiveName"
      id: archive
      
    - name: Upload ZIP build artifacts
      uses: actions/upload-artifact@v4
      with:
        name: thoughtecho-windows-${{ github.event.inputs.build_type || 'release' }}-zip
        path: ${{ steps.archive.outputs.archive_name }}
        retention-days: 90
        
    - name: Upload MSIX installer
      if: steps.archive.outputs.has_msix == 'true'
      uses: actions/upload-artifact@v4
      with:
        name: thoughtecho-windows-${{ github.event.inputs.build_type || 'release' }}-msix
        path: ${{ steps.archive.outputs.msix_name }}
        retention-days: 90
        
    - name: Build summary
      run: |
        $version = "${{ steps.version.outputs.version }}"
        $buildType = "${{ github.event.inputs.build_type || 'release' }}"
        $archiveName = "${{ steps.archive.outputs.archive_name }}"
        $msixName = "${{ steps.archive.outputs.msix_name }}"
        $hasMsix = "${{ steps.archive.outputs.has_msix }}" -eq "true"
        
        Write-Output "## ðŸŽ‰ Windowsæž„å»ºå®Œæˆ" >> $env:GITHUB_STEP_SUMMARY
        Write-Output "" >> $env:GITHUB_STEP_SUMMARY
        Write-Output "### ðŸ“‹ æž„å»ºä¿¡æ¯" >> $env:GITHUB_STEP_SUMMARY
        Write-Output "- **åº”ç”¨ç‰ˆæœ¬**: $version" >> $env:GITHUB_STEP_SUMMARY
        Write-Output "- **æž„å»ºç±»åž‹**: $buildType" >> $env:GITHUB_STEP_SUMMARY
        Write-Output "- **Flutterç‰ˆæœ¬**: ${{ github.event.inputs.flutter_version || '3.29.2' }}" >> $env:GITHUB_STEP_SUMMARY
        Write-Output "- **æäº¤å“ˆå¸Œ**: ${{ github.sha }}" >> $env:GITHUB_STEP_SUMMARY
        Write-Output "" >> $env:GITHUB_STEP_SUMMARY
        Write-Output "### ðŸ“¦ å‘å¸ƒæ–‡ä»¶" >> $env:GITHUB_STEP_SUMMARY
        Write-Output "- **ZIPåŽ‹ç¼©åŒ…**: âœ… $archiveName" >> $env:GITHUB_STEP_SUMMARY
        
        if ($hasMsix -and $msixName) {
            Write-Output "- **MSIXå®‰è£…åŒ…**: âœ… $msixName" >> $env:GITHUB_STEP_SUMMARY
        } else {
            Write-Output "- **MSIXå®‰è£…åŒ…**: âŒ æž„å»ºå¤±è´¥ï¼ˆå¯ä½¿ç”¨ZIPåŒ…æ›¿ä»£ï¼‰" >> $env:GITHUB_STEP_SUMMARY
        }
        
        Write-Output "" >> $env:GITHUB_STEP_SUMMARY
        Write-Output "### ðŸ“¥ ä¸‹è½½è¯´æ˜Ž" >> $env:GITHUB_STEP_SUMMARY
        Write-Output "1. åœ¨Actionsé¡µé¢çš„Artifactséƒ¨åˆ†ä¸‹è½½å¯¹åº”çš„å‘å¸ƒåŒ…" >> $env:GITHUB_STEP_SUMMARY
        Write-Output "2. **ZIPåŒ…**: è§£åŽ‹åŽç›´æŽ¥è¿è¡Œ thoughtecho.exe" >> $env:GITHUB_STEP_SUMMARY
        
        if ($hasMsix) {
            Write-Output "3. **MSIXåŒ…**: åŒå‡»å®‰è£…åˆ°ç³»ç»Ÿï¼ˆæŽ¨èï¼‰" >> $env:GITHUB_STEP_SUMMARY
        } else {
            Write-Output "3. **MSIXåŒ…**: æœ¬æ¬¡æž„å»ºå¤±è´¥ï¼Œè¯·ä½¿ç”¨ZIPåŒ…" >> $env:GITHUB_STEP_SUMMARY
        }
        
        Write-Output "" >> $env:GITHUB_STEP_SUMMARY
        Write-Output "### âš ï¸ æ³¨æ„äº‹é¡¹" >> $env:GITHUB_STEP_SUMMARY
        Write-Output "- é¦–æ¬¡å¯åŠ¨å¯èƒ½éœ€è¦ç­‰å¾…æ•°ç§’" >> $env:GITHUB_STEP_SUMMARY
        Write-Output "- ç¡®ä¿ç³»ç»Ÿå·²å®‰è£… Visual C++ Redistributable" >> $env:GITHUB_STEP_SUMMARY
        Write-Output "- å»ºè®®å°†åº”ç”¨æ–‡ä»¶å¤¹æ·»åŠ åˆ°æ€æ¯’è½¯ä»¶ç™½åå•" >> $env:GITHUB_STEP_SUMMARY
